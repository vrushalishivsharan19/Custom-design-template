{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/blocksdk/blocksdk.js","webpack:///./src/components/image-card.js","webpack:///./src/lib/api.js","webpack:///./src/components/templating-block-selector.js","webpack:///./src/components/image-selector.js","webpack:///./src/components/templating-block-fieldset.js","webpack:///./src/components/templating-block-app.js","webpack:///./src/lib/templating-block-utils.js","webpack:///./src/main.js"],"names":["enumerable","get","getter","value","key","bind","module","Object","prototype","hasOwnProperty","call","object","property","SDK","config","whitelistOverride","sslOverride","Array","isArray","undefined","this","_whitelistOverride","_sslOverride","_messageId","_messages","0","_readyToPost","_pendingMessages","_receiveMessage","window","addEventListener","parent","postMessage","method","origin","location","payload","execute","options","data","callback","success","_post","push","getCentralData","cb","getContent","getData","getUserData","getView","setBlockEditorWidth","setCentralData","dataObj","setContent","content","setData","setSuperContent","triggerAuth","appID","userData","stack","indexOf","substring","iframe","document","createElement","src","style","width","height","position","top","left","visibility","className","body","appendChild","_executePendingMessages","self","forEach","thisMessage","id","_parentOrigin","message","_validateOrigin","allowedDomains","i","length","optionalSsl","mcSubdomain","RegExp","test","sfdc","BlockSDK","exports","template","innerHTML","ImageCard","HTMLElement","cloneNode","getElementsByClassName","innerText","getAttribute","getElementsByTagName","dispatchEvent","CustomEvent","detail","bubbles","customElements","define","async","post","url","response","fetch","JSON","stringify","json","getImages","images","query","simpleOperator","getImagesCached","querySelector","e","stopPropagation","assets","items","find","asset","target","getCustomTemplates","map","getRadioHtml","join","assetId","getElementById","checked","name","super","_toggleSelector","grid","_getImageHTML","image","fileProperties","publishedURL","display","TemplatingBlockFieldSet","val","firstElementChild","getFieldHtml","_fields","fields","field","idx","title","type","TemplatingBlockApp","fieldSet","locked","selector","placeholderRegex","parseTemplate","match","exec","getHtml","isFallback","replace","placeholder","replaceVal","sdk","setEverything","getOverrideData","getBlock","app","blockData","newBlockData","initializeApp"],"mappings":"aACA,SAGA,cAGA,QACA,oBAGA,YACA,IACA,KACA,YAUA,OANA,mCAGA,OAGA,UAKA,MAGA,MAGA,oBACA,UACA,2BAA2CA,YAAY,EAAMC,IAAKC,KAKlE,gBACA,gDACA,4CAAyDC,MAAO,WAEhE,sCAAkDA,OAAO,KAQzD,kBAEA,GADA,cACA,aACA,qDACA,0BAGA,GAFA,OACA,mCAA0CH,YAAY,EAAMG,MAAOA,IACnE,2DAAiH,OAAOA,EAAMC,IAAQC,KAAK,KAAMD,IACjJ,UAIA,gBACA,sBACA,WAA4B,OAAOE,EAAgB,SACnD,WAAkC,OAAOA,GAEzC,OADA,aACA,GAIA,kBAAuD,OAAOC,OAAOC,UAAUC,eAAeC,KAAKC,EAAQC,IAG3G,OAIA,S,kBC3EA,IAAIC,EAAM,SAAUC,EAAQC,EAAmBC,GAI1CC,MAAMC,QAAQJ,KAEjBE,EADAD,EAAoBD,EAEpBA,OAASK,GAGVC,KAAKC,mBAAqBN,EAC1BK,KAAKE,aAAeN,EACpBI,KAAKG,WAAa,EAClBH,KAAKI,UAAY,CAChBC,EAAG,cAEJL,KAAKM,cAAe,EACpBN,KAAKO,iBAAmB,GACxBP,KAAKQ,gBAAkBR,KAAKQ,gBAAgBvB,KAAKe,MAEjDS,OAAOC,iBAAiB,UAAWV,KAAKQ,iBAAiB,GAEzDC,OAAOE,OAAOC,YAAY,CACzBC,OAAQ,YACRC,OAAQL,OAAOM,SAASD,OACxBE,QAAStB,GACP,MAGJD,EAAIL,UAAU6B,QAAU,SAAkBJ,EAAQK,GAGjD,IACIF,GAHJE,EAAUA,GAAW,IAGCC,KAClBC,EAAWF,EAAQG,QAElBrB,KAAKM,aAOTN,KAAKsB,MAAM,CACVT,OAAQA,EACRG,QAASA,GACPI,GATHpB,KAAKO,iBAAiBgB,KAAK,CAC1BV,OAAQA,EACRG,QAASA,EACTI,SAAUA,KAUb3B,EAAIL,UAAUoC,eAAiB,SAAUC,GACxCzB,KAAKiB,QAAQ,iBAAkB,CAC9BI,QAASI,KAIXhC,EAAIL,UAAUsC,WAAa,SAAUD,GACpCzB,KAAKiB,QAAQ,aAAc,CAC1BI,QAASI,KAIXhC,EAAIL,UAAUuC,QAAU,SAAUF,GACjCzB,KAAKiB,QAAQ,UAAW,CACvBI,QAASI,KAIXhC,EAAIL,UAAUwC,YAAc,SAAUH,GACrCzB,KAAKiB,QAAQ,cAAe,CAC3BI,QAASI,KAIXhC,EAAIL,UAAUyC,QAAU,SAAUJ,GACjCzB,KAAKiB,QAAQ,UAAW,CACvBI,QAASI,KAIXhC,EAAIL,UAAU0C,oBAAsB,SAAU/C,EAAO0C,GACpDzB,KAAKiB,QAAQ,sBAAuB,CACnCE,KAAMpC,EACNsC,QAASI,KAIXhC,EAAIL,UAAU2C,eAAiB,SAAUC,EAASP,GACjDzB,KAAKiB,QAAQ,iBAAkB,CAC9BE,KAAMa,EACNX,QAASI,KAIXhC,EAAIL,UAAU6C,WAAa,SAAUC,EAAST,GAC7CzB,KAAKiB,QAAQ,aAAc,CAC1BE,KAAMe,EACNb,QAASI,KAGXhC,EAAIL,UAAU+C,QAAU,SAAUH,EAASP,GAC1CzB,KAAKiB,QAAQ,UAAW,CACvBE,KAAMa,EACNX,QAASI,KAIXhC,EAAIL,UAAUgD,gBAAkB,SAAUF,EAAST,GAClDzB,KAAKiB,QAAQ,kBAAmB,CAC/BE,KAAMe,EACNb,QAASI,KAIXhC,EAAIL,UAAUiD,YAAc,SAAUC,GACrCtC,KAAK4B,aAAY,SAAUW,GAC1B,IAAIC,EAAQD,EAASC,MACO,IAAxBA,EAAMC,QAAQ,QACjBD,EAAQA,EAAME,UAAU,EAAE,GAAK,IAAMF,EAAME,UAAU,EAAE,IAExD,IAAIC,EAASC,SAASC,cAAc,UACpCF,EAAOG,IAAM,cAAgBN,EAAQ,+CAAiDF,EAAQ,qBAC9FK,EAAOI,MAAMC,MAAO,MACpBL,EAAOI,MAAME,OAAS,MACtBN,EAAOI,MAAMG,SAAW,WACxBP,EAAOI,MAAMI,IAAM,IACnBR,EAAOI,MAAMK,KAAO,IACpBT,EAAOI,MAAMM,WAAa,SAC1BV,EAAOW,UAAY,YACnBV,SAASW,KAAKC,YAAYb,OAM5BlD,EAAIL,UAAUqE,wBAA0B,WACvC,IAAIC,EAAO1D,KAEXA,KAAKO,iBAAiBoD,SAAQ,SAAUC,GACvCF,EAAKzC,QAAQ2C,EAAY/C,OAAQ,CAChCM,KAAMyC,EAAY5C,QAClBK,QAASuC,EAAYxC,cAIvBpB,KAAKO,iBAAmB,IAGzBd,EAAIL,UAAUkC,MAAQ,SAAgBN,EAASI,GAC9CpB,KAAKI,UAAUJ,KAAKG,YAAciB,EAClCJ,EAAQ6C,GAAK7D,KAAKG,WAClBH,KAAKG,YAAc,EAEnBM,OAAOE,OAAOC,YAAYI,EAAShB,KAAK8D,gBAGzCrE,EAAIL,UAAUoB,gBAAkB,SAA0BuD,GAEzD,IAAI5C,GADJ4C,EAAUA,GAAW,IACF5C,MAAQ,GAE3B,GAAoB,cAAhBA,EAAKN,QACJb,KAAKgE,gBAAgB7C,EAAKL,QAI7B,OAHAd,KAAK8D,cAAgB3C,EAAKL,OAC1Bd,KAAKM,cAAe,OACpBN,KAAKyD,0BAMFzD,KAAK8D,eAAiB9D,KAAK8D,gBAAkBC,EAAQjD,UAIzDd,KAAKI,UAAUe,EAAK0C,IAAM,IAAM,cAAgB1C,EAAKH,gBAC/ChB,KAAKI,UAAUe,EAAK0C,MAI5BpE,EAAIL,UAAU4E,gBAAkB,SAA0BlD,GAIzD,IAFA,IAAImD,EAAiBjE,KAAKC,oBAAsB,CAAC,oBAAqB,2BAA4B,iCAEzFiE,EAAI,EAAGA,EAAID,EAAeE,OAAQD,IAAK,CAE/C,IAAIE,EAAcpE,KAAKE,aAAe,IAAM,GACxCmE,EAAoC,sBAAtBJ,EAAeC,GAA6B,QAAU,GAGxE,GAFqB,IAAII,OAAO,SAAWF,EAAc,MAAQC,EAAc,sBAAwBJ,EAAeC,GAAK,cAAe,KAEvHK,KAAKzD,GACvB,OAAO,EAIT,OAAO,GAGe,iBAAb,SACTL,OAAO+D,KAAO/D,OAAO+D,MAAQ,GAC7B/D,OAAO+D,KAAKC,SAAWhF,GAGvBP,EAAOwF,QAAUjF,G,cCjNlB,IAAIkF,EAAW/B,SAASC,cAAc,YACtC8B,EAASC,UAAY,wOASrB,MAAMC,UAAkBC,YACvB,oBACC9E,KAAKwD,YAAYmB,EAASzC,QAAQ6C,WAAU,IAE5C/E,KAAKgF,uBAAuB,QAAQ,GAAGC,UAAYjF,KAAKkF,aAAa,QACrElF,KAAKmF,qBAAqB,OAAO,GAAGrC,IAAM9C,KAAKkF,aAAa,OAE5DlF,KAAKU,iBAAiB,QAAS,KAC9BV,KAAKoF,cAAc,IAAIC,YAAY,SAAU,CAC5CC,OAAQ,CACPvG,MAAOiB,KAAKkF,aAAa,QAE1BK,SAAS,QAMbC,eAAeC,OAAO,aAAcZ,I,6BC5BpCa,eAAeC,EAAKC,EAAKzE,GACvB,MAAM0E,QAAiBC,MAAM,UAAYF,EAAK,CAC5C/E,OAAQ,OACR0C,KAAMwC,KAAKC,UAAU7E,KAEvB,aAAa0E,EAASI,O,OAkCjB,MAAMC,EAhBb,WACE,IAAIC,EACJ,OAAOT,UACAS,IACHA,EAASR,EAAK,gCAAiC,CAC7CS,MAAO,CACL5G,SAAU,eACV6G,eAAgB,KAChBtH,MAAO,CAAC,GAAI,GAAI,GAAI,QAInBoH,GAIcG,GCrCnB3B,EAAW/B,SAASC,cAAc,YACxC8B,EAASC,UAAY,oPAQrB,MAAM,UAAgCE,YACrC,0BACC9E,KAAKwD,YAAYmB,EAASzC,QAAQ6C,WAAU,IAE5C/E,KAAKuG,cAAc,+BAA+B7F,iBAAiB,SAAU8F,IAC5EA,EAAEC,kBACEC,GACH1G,KAAKoF,cAAc,IAAIC,YAAY,SAAU,CAC5CC,OAAQ,CACPX,SAAU+B,EAAOC,MAAMC,KAAKC,GAASL,EAAEM,OAAO/H,OAAS8H,EAAMhD,KAE9D0B,SAAS,OAKZ,MAAMmB,QDdDhB,iBACL,aAAaC,EAAK,gCAAiC,CACjDS,MAAO,CACL5G,SAAU,OACV6G,eAAgB,QAChBtH,MAAO,yBCSUgI,GAErB/G,KAAKuG,cAAc,+BAA+B3B,UAAY8B,EAAOC,MAAMK,IAAIhH,KAAKiH,cAAcC,KAAK,IACnGlH,KAAKmH,UACRvE,SAASwE,eAAepH,KAAKmH,SAASE,QAAU,WAIlD,aAAaR,GACZ,MAAO,0DAEkBA,EAAMhD,cAAcgD,EAAMhD,mEACZgD,EAAMhD,+FAEJgD,EAAMS,oCAMjD9B,eAAeC,OAAO,4BAA6B,G,KC5CnD,MAAM,EAAW7C,SAASC,cAAc,YACxC,EAAS+B,UAAY,8KAKrB,MAAM,UAAsBE,YAC3B,cACCyC,QAEAvH,KAAKwH,gBAAkBxH,KAAKwH,gBAAgBvI,KAAKe,MAGlD,0BACCA,KAAKwD,YAAY,EAAStB,QAAQ6C,WAAU,IAC5C/E,KAAKyH,KAAOzH,KAAKgF,uBAAuB,aAAa,GAErDhF,KAAKmF,qBAAqB,UAAU,GAAGzE,iBAAiB,QAASV,KAAKwH,iBAEtExH,KAAKU,iBAAiB,SAAU8F,IAC/BxG,KAAKjB,MAAQyH,EAAElB,OAAOvG,MACtBiB,KAAKwH,oBAGN,MAAMrB,QAAeD,IACrBlG,KAAKyH,KAAK7C,UAAYuB,EAAOQ,MAAMK,IAAIhH,KAAK0H,eAAeR,KAAK,IAGjE,cAAcS,GACb,MAAO,mFAEUA,EAAM9D,aAAa8D,EAAML,cAAcK,EAAMC,eAAeC,4CAK9E,kBACC7H,KAAKyH,KAAK1E,MAAM+E,QAAsC,SAA5B9H,KAAKyH,KAAK1E,MAAM+E,QAAqB,OAAS,QAI1EtC,eAAeC,OAAO,iBAAkB,GC1CxC,MAAM,EAAW7C,SAASC,cAAc,YACxC,EAAS+B,UAAY,qCAKrB,MAAMmD,UAAgCjD,YACrC,WAAWkD,GACNA,IACHhI,KAAKiI,kBAAkBrD,UAAYoD,EAAIhB,IAAIhH,KAAKkI,cAAchB,KAAK,IACnElH,KAAKmI,QAAUH,GAIjB,0BACChI,KAAKwD,YAAY,EAAStB,QAAQ6C,WAAU,IAE5C/E,KAAKiI,kBAAkBvH,iBAAiB,SAAU8F,IACjDA,EAAEC,kBACFzG,KAAKoF,cAAc,IAAIC,YAAY,SAAU,CAC5CC,OAAQ,CACP8C,OAAQpI,KAAKmI,QAAQnB,IACpB,CAACqB,EAAOC,KACA,IACHD,EACHtJ,MAAOiB,KAAKuG,cAAc,mBAAmB+B,GAAOvJ,UAKxDwG,SAAS,OAKZ,aAAa8C,EAAOC,GACnB,MAAO,oGAEsDA,MAAQD,EAAME,kEAE1D,UAAfF,EAAMG,KACP,mBACA,+DACsBF,aAAeD,EAAMtJ,OAAS,8BAOvDyG,eAAeC,OAAO,4BAA6BsC,GCjDnD,MAAMU,UAA2B3D,YAChC,WAAWkD,GACVhI,KAAK0I,SAASN,OAASJ,EAGxB,oBACC,MAAM5C,EAAgBoD,GAAQhC,GAC7BxG,KAAKoF,cAAc,IAAIC,YAAY,SAAU,CAC5CC,OAAQ,IACJkB,EAAElB,OACLkD,KAAMA,GAEPjD,SAAS,KAIX,IAAKvF,KAAK2I,OAAQ,CACjB,MAAMC,EAAWhG,SAASC,cAAc,6BACxC+F,EAASzB,QAAUnH,KAAKmH,QACxBnH,KAAKwD,YAAYoF,GACjBA,EAASlI,iBAAiB,SAAU0E,EAAc,aAGnDpF,KAAK0I,SAAW9F,SAASC,cAAc,6BACvC7C,KAAKwD,YAAYxD,KAAK0I,UAEtB1I,KAAK0I,SAAShI,iBAAiB,SAAU0E,EAAc,YAIzDI,eAAeC,OAAO,uBAAwBgD,G,WCjC9C,MAAMI,EAAmB,oCAElB,SAASC,EAAenE,GAC9B,MAAMyD,EAAS,GACf,IAAIW,EAEJ,KAAOA,EAAQF,EAAiBG,KAAKrE,EAASzC,UAC7CkG,EAAO7G,KAAK,CACXiH,KAAMO,EAAM,GACZR,MAAOQ,EAAM,KAIf,OAAOX,EAGD,SAASa,EAAQtE,EAAUyD,EAAS,GAAIc,GAC9C,IAAIZ,EAAM,EACV,OAAO3D,EAASzC,QAAQiH,QAAQN,EAC/B,CAACE,EAAOP,EAAMD,EAAOa,KACpB,IAAIC,EAAa,GAOjB,OANIjB,EAAOE,IAAQF,EAAOE,GAAKvJ,MAC9BsK,EAAajB,EAAOE,GAAKvJ,MACfmK,IACVG,EAAaD,GAEdd,IACOe,ICtBV,MAAMC,EAAM,I,OAAI,GAqChB,SAASC,EAAcpI,GAEtBmI,EAAInH,QAAQhB,GAEZmI,EAAIrH,WAAWgH,EAAQ9H,EAAKwD,SAAUxD,EAAKiH,QAAQ,IAEnDkB,EAAIlH,gBAAgB6G,EAAQ9H,EAAKwD,SAAUxD,EAAKiH,QAAQ,IAGzD1C,eAAe8D,EAAgBrI,EAAMgG,GAUpC,OATAhG,EAAKwD,eN5CCe,eAAwB7B,GAC7B,MAAMgC,QAAiBC,MAAM,kCAAkCjC,GAC/D,aAAagC,EAASI,OM0CDwD,CAAStC,GAC/BhG,EAAKiH,OAASU,EAAc3H,EAAKwD,UAAUqC,IAAI,CAACqB,EAAOC,KAC/C,IACHD,EACHtJ,MAAOoC,EAAKiH,QAAUjH,EAAKiH,OAAOE,IAAQnH,EAAKiH,OAAOE,GAAKvJ,OAAS,MAGtEoC,EAAKwH,QAAS,EAEPxH,EAGRmI,EAAI3H,QAAQ+D,MAAOvE,IAClB,GAAIV,OAAOiJ,IAAIvC,QAAS,CAEvBoC,QAD2BC,EAAgBrI,EAAMV,OAAOiJ,IAAIvC,WA3D9D,SAAuBhG,GACtB,MAAMuI,EAAM9G,SAASC,cAAc,wBACnC6G,EAAIf,OAASxH,EAAKwH,OACdxH,EAAKwD,WACR+E,EAAIvC,QAAUhG,EAAKwD,SAASd,IAI7B6F,EAAIhJ,iBAAiB,SAAU8F,IAE9B8C,EAAI3H,QAAQgI,IACX,MAAMC,EAAeD,EAGrB,OAAQnD,EAAElB,OAAOkD,MAChB,IAAK,WACJoB,EAAajF,SAAW6B,EAAElB,OAAOX,SACjCiF,EAAaxB,OAASU,EAAcc,EAAajF,UACjD+E,EAAItB,OAASwB,EAAaxB,OAC1B,MACD,IAAK,SACJwB,EAAaxB,OAAS5B,EAAElB,OAAO8C,OAMjCmB,EAAcK,OAIhBhH,SAASwE,eAAe,aAAa5D,YAAYkG,GACjDA,EAAItB,OAASjH,EAAKiH,OA+BlByB,CAAc1I,KAGfmI,EAAIjH,YAAY5B,OAAOiJ,IAAIpH","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n","/*\n * Copyright (c) 2018, salesforce.com, inc.\n * All rights reserved.\n * Licensed under the BSD 3-Clause license.\n * For full license text, see LICENSE.txt file in the repo root  or https://opensource.org/licenses/BSD-3-Clause\n */\n\nvar SDK = function (config, whitelistOverride, sslOverride) {\n\t// config has been added as the primary parameter\n\t// If it is provided ensure that the other paramaters are correctly assigned\n\t// for backwards compatibility\n\tif (Array.isArray(config)) {\n\t\twhitelistOverride = config;\n\t\tsslOverride = whitelistOverride;\n\t\tconfig = undefined;\n\t}\n\n\tthis._whitelistOverride = whitelistOverride;\n\tthis._sslOverride = sslOverride;\n\tthis._messageId = 1;\n\tthis._messages = {\n\t\t0: function () {}\n\t};\n\tthis._readyToPost = false;\n\tthis._pendingMessages = [];\n\tthis._receiveMessage = this._receiveMessage.bind(this);\n\n\twindow.addEventListener('message', this._receiveMessage, false);\n\n\twindow.parent.postMessage({\n\t\tmethod: 'handShake',\n\t\torigin: window.location.origin,\n\t\tpayload: config\n\t}, '*');\n};\n\nSDK.prototype.execute = function execute (method, options) {\n\toptions = options || {};\n\t\n\tvar self = this;\n\tvar payload = options.data;\n\tvar callback = options.success;\n\n\tif (!this._readyToPost) {\n\t\tthis._pendingMessages.push({\n\t\t\tmethod: method,\n\t\t\tpayload: payload,\n\t\t\tcallback: callback\n\t\t});\n\t} else {\n\t\tthis._post({\n\t\t\tmethod: method,\n\t\t\tpayload: payload\n\t\t}, callback);\n\t}\n};\n\nSDK.prototype.getCentralData = function (cb) {\n\tthis.execute('getCentralData', {\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.getContent = function (cb) {\n\tthis.execute('getContent', {\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.getData = function (cb) {\n\tthis.execute('getData', {\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.getUserData = function (cb) {\n\tthis.execute('getUserData', {\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.getView = function (cb) {\n\tthis.execute('getView', {\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.setBlockEditorWidth = function (value, cb) {\n\tthis.execute('setBlockEditorWidth', {\n\t\tdata: value,\n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.setCentralData = function (dataObj, cb) {\n\tthis.execute('setCentralData', {\n\t\tdata: dataObj, \n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.setContent = function (content, cb) {\n\tthis.execute('setContent', {\n\t\tdata: content, \n\t\tsuccess: cb});\n};\n\nSDK.prototype.setData = function (dataObj, cb) {\n\tthis.execute('setData', {\n\t\tdata: dataObj, \n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.setSuperContent = function (content, cb) {\n\tthis.execute('setSuperContent', {\n\t\tdata: content, \n\t\tsuccess: cb\n\t});\n};\n\nSDK.prototype.triggerAuth = function (appID) {\n\tthis.getUserData(function (userData) {\n\t\tvar stack = userData.stack;\n\t\tif (stack.indexOf('qa') === 0) {\n\t\t\tstack = stack.substring(3,5) + '.' + stack.substring(0,3);\n\t\t}\n\t\tvar iframe = document.createElement('IFRAME');\n\t\tiframe.src = 'https://mc.' + stack + '.exacttarget.com/cloud/tools/SSO.aspx?appId=' + appID + '&restToken=1&hub=1';\n\t\tiframe.style.width= '1px';\n\t\tiframe.style.height = '1px';\n\t\tiframe.style.position = 'absolute';\n\t\tiframe.style.top = '0';\n\t\tiframe.style.left = '0';\n\t\tiframe.style.visibility = 'hidden';\n\t\tiframe.className = 'authframe';\n\t\tdocument.body.appendChild(iframe);\n\t});\n};\n\n/* Internal Methods */\n\nSDK.prototype._executePendingMessages = function _executePendingMessages () {\n\tvar self = this;\n\n\tthis._pendingMessages.forEach(function (thisMessage) {\n\t\tself.execute(thisMessage.method, {\n\t\t\tdata: thisMessage.payload, \n\t\t\tsuccess: thisMessage.callback\n\t\t});\n\t});\n\n\tthis._pendingMessages = [];\n};\n\nSDK.prototype._post = function _post (payload, callback) {\n\tthis._messages[this._messageId] = callback;\n\tpayload.id = this._messageId;\n\tthis._messageId += 1;\n\t// the actual postMessage always uses the validated origin\n\twindow.parent.postMessage(payload, this._parentOrigin);\n};\n\nSDK.prototype._receiveMessage = function _receiveMessage (message) {\n\tmessage = message || {};\n\tvar data = message.data || {};\n\n\tif (data.method === 'handShake') {\n\t\tif (this._validateOrigin(data.origin)) {\n\t\t\tthis._parentOrigin = data.origin;\n\t\t\tthis._readyToPost = true;\n\t\t\tthis._executePendingMessages();\n\t\t\treturn;\n\t\t}\n\t}\n\n\t// if the message is not from the validated origin it gets ignored\n\tif (!this._parentOrigin || this._parentOrigin !== message.origin) {\n\t\treturn;\n\t}\n\t// when the message has been received, we execute its callback\n\t(this._messages[data.id || 0] || function () {})(data.payload);\n\tdelete this._messages[data.id];\n};\n\n// the custom block should verify it is being called from the marketing cloud\nSDK.prototype._validateOrigin = function _validateOrigin (origin) {\n\t// Make sure to escape periods since these strings are used in a regular expression\n\tvar allowedDomains = this._whitelistOverride || ['exacttarget\\\\.com', 'marketingcloudapps\\\\.com', 'blocktester\\\\.herokuapp\\\\.com'];\n\n\tfor (var i = 0; i < allowedDomains.length; i++) {\n\t\t// Makes the s optional in https\n\t\tvar optionalSsl = this._sslOverride ? '?' : '';\n\t\tvar mcSubdomain = allowedDomains[i] === 'exacttarget\\\\.com' ? 'mc\\\\.' : '';\n\t\tvar whitelistRegex = new RegExp('^https' + optionalSsl + '://' + mcSubdomain + '([a-zA-Z0-9-]+\\\\.)*' + allowedDomains[i] + '(:[0-9]+)?$', 'i');\n\n\t\tif (whitelistRegex.test(origin)) {\n\t\t\treturn true;\n\t\t}\n\t}\n\n\treturn false;\n};\n\nif (typeof(window) === 'object') {\n\twindow.sfdc = window.sfdc || {};\n\twindow.sfdc.BlockSDK = SDK;\n}\nif (typeof(module) === 'object') {\n\tmodule.exports = SDK;\n}\n","let template = document.createElement('template');\ntemplate.innerHTML = `\n<article class=\"slds-box slds-box\" style=\"cursor: pointer; height: 100%;\">\n\t<span class=\"name\" style=\"word-break: break-all;\"></span>\n\t<div class=\"slds-card__body slds-card__body_inner\">\n\t\t<img />\n\t</div>\n</article>\n`;\n\nclass ImageCard extends HTMLElement {\n\tconnectedCallback() {\n\t\tthis.appendChild(template.content.cloneNode(true));\n\n\t\tthis.getElementsByClassName('name')[0].innerText = this.getAttribute('name');\n\t\tthis.getElementsByTagName('img')[0].src = this.getAttribute('url');\n\n\t\tthis.addEventListener('click', () => {\n\t\t\tthis.dispatchEvent(new CustomEvent('change', {\n\t\t\t\tdetail: {\n\t\t\t\t\tvalue: this.getAttribute('url')\n\t\t\t\t},\n\t\t\t\tbubbles: true\n\t\t\t}));\n\t\t});\n\t}\n}\n\ncustomElements.define('image-card', ImageCard);\n","async function post(url, data) {\n  const response = await fetch(\"/proxy/\" + url, {\n    method: \"POST\",\n    body: JSON.stringify(data),\n  });\n  return await response.json();\n}\n\nexport async function getBlock(id) {\n  const response = await fetch(`/proxy/asset/v1/content/assets/${id}`);\n  return await response.json();\n}\n\nexport async function getCustomTemplates() {\n  return await post(\"asset/v1/content/assets/query\", {\n    query: {\n      property: \"tags\",\n      simpleOperator: \"where\",\n      value: \"customblocktemplate\",\n    },\n  });\n}\n\nfunction getImagesCached() {\n  let images;\n  return async () => {\n    if (!images) {\n      images = post(\"asset/v1/content/assets/query\", {\n        query: {\n          property: \"assetType.id\",\n          simpleOperator: \"in\",\n          value: [20, 22, 23, 28],\n        },\n      });\n    }\n    return images;\n  };\n}\n\nexport const getImages = getImagesCached();\n","import { getCustomTemplates } from '../lib/api';\n\nconst template = document.createElement('template');\ntemplate.innerHTML = `\n<fieldset class=\"slds-form-element slds-box slds-m-bottom_x-small\">\n  <legend class=\"slds-form-element__legend slds-form-element__label\">Choose a block template</legend>\n  <div class=\"slds-form-element__control\">\n  </div>\n</fieldset>\n`;\n\nclass TemplatingBlockSelector extends HTMLElement {\n\tasync connectedCallback() {\n\t\tthis.appendChild(template.content.cloneNode(true));\n\n\t\tthis.querySelector('.slds-form-element__control').addEventListener('change', e => {\n\t\t\te.stopPropagation();\n\t\t\tif (assets) {\n\t\t\t\tthis.dispatchEvent(new CustomEvent('change', {\n\t\t\t\t\tdetail: {\n\t\t\t\t\t\ttemplate: assets.items.find(asset => e.target.value == asset.id)\n\t\t\t\t\t},\n\t\t\t\t\tbubbles: false\n\t\t\t\t}));\n\t\t\t}\n\t\t});\n\n\t\tconst assets = await getCustomTemplates();\n\n\t\tthis.querySelector('.slds-form-element__control').innerHTML = assets.items.map(this.getRadioHtml).join('');\n\t\tif (this.assetId) {\n\t\t\tdocument.getElementById(this.assetId).checked = 'checked';\n\t\t}\n\t}\n\n\tgetRadioHtml(asset) {\n\t\treturn `\n<span class=\"slds-radio\">\n\t<input type=\"radio\" id=\"${asset.id}\" value=\"${asset.id}\" name=\"template\" />\n\t<label class=\"slds-radio__label\" for=\"${asset.id}\">\n\t\t<span class=\"slds-radio_faux\"></span>\n\t\t<span class=\"slds-form-element__label\">${asset.name}</span>\n\t</label>\n</span>`;\n\t}\n}\n\ncustomElements.define('templating-block-selector', TemplatingBlockSelector);\n","import { getImages } from '../lib/api';\nimport './image-card';\n\nconst template = document.createElement('template');\ntemplate.innerHTML = `\n<button class=\"slds-button slds-button_neutral\">Select</button>\n<div class=\"slds-grid slds-gutters slds-wrap slds-grid_vertical-stretch\" style=\"display: none;\"></div>\n`;\n\nclass ImageSelector extends HTMLElement {\n\tconstructor () {\n\t\tsuper();\n\n\t\tthis._toggleSelector = this._toggleSelector.bind(this);\n\t}\n\n\tasync connectedCallback() {\n\t\tthis.appendChild(template.content.cloneNode(true));\n\t\tthis.grid = this.getElementsByClassName('slds-grid')[0];\n\n\t\tthis.getElementsByTagName('button')[0].addEventListener('click', this._toggleSelector);\n\n\t\tthis.addEventListener('change', e => {\n\t\t\tthis.value = e.detail.value;\n\t\t\tthis._toggleSelector();\n\t\t});\n\n\t\tconst images = await getImages();\n\t\tthis.grid.innerHTML = images.items.map(this._getImageHTML).join('');\n\t}\n\n\t_getImageHTML(image) {\n\t\treturn `\n<div class=\"slds-col slds-size_1-of-2 slds-p-top_x-small\">\n\t<image-card id=\"${image.id}\" name=\"${image.name}\" url=\"${image.fileProperties.publishedURL}\"></image-card>\n</div>\n\t\t`;\n\t}\n\n\t_toggleSelector() {\n\t\tthis.grid.style.display = this.grid.style.display === 'none' ? 'flex' : 'none';\n\t}\n}\n\ncustomElements.define('image-selector', ImageSelector);\n","import './image-selector';\n\nconst template = document.createElement('template');\ntemplate.innerHTML = `\n<div class=\"slds-box\">\n</div>\n`;\n\nclass TemplatingBlockFieldSet extends HTMLElement {\n\tset fields(val) {\n\t\tif (val) {\n\t\t\tthis.firstElementChild.innerHTML = val.map(this.getFieldHtml).join('');\n\t\t\tthis._fields = val;\n\t\t}\n\t}\n\n\tasync connectedCallback() {\n\t\tthis.appendChild(template.content.cloneNode(true));\n\n\t\tthis.firstElementChild.addEventListener('change', e => {\n\t\t\te.stopPropagation();\n\t\t\tthis.dispatchEvent(new CustomEvent('change', {\n\t\t\t\tdetail: {\n\t\t\t\t\tfields: this._fields.map(\n\t\t\t\t\t\t(field, idx) => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...field,\n\t\t\t\t\t\t\t\tvalue: this.querySelector(`#template-field-${idx}`).value\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t)\n\t\t\t\t},\n\t\t\t\tbubbles: false\n\t\t\t}));\n\t\t});\n\t}\n\n\tgetFieldHtml(field, idx) {\n\t\treturn `\n<div class=\"slds-form-element\">\n\t<label class=\"slds-form-element__label\" for=\"template-field-${idx}\">${field.title}</label>\n\t<div class=\"slds-form-element__control\">\n\t\t${field.type === 'image' ?\n\t\t\t'<image-selector ' :\n\t\t\t'<input type=\"text\" class=\"slds-input\" '\n\t\t} id=\"template-field-${idx}\" value=\"${field.value || ''}\" />\n\t</div>\n</div>\n`;\n\t}\n}\n\ncustomElements.define('templating-block-fieldset', TemplatingBlockFieldSet);\n","import './templating-block-selector';\nimport './templating-block-fieldset';\n\nclass TemplatingBlockApp extends HTMLElement {\n\tset fields(val) {\n\t\tthis.fieldSet.fields = val;\n\t}\n\n\tconnectedCallback() {\n\t\tconst dispatchEvent = type => e =>\n\t\t\tthis.dispatchEvent(new CustomEvent('change', {\n\t\t\t\tdetail: {\n\t\t\t\t\t...e.detail,\n\t\t\t\t\ttype: type\n\t\t\t\t},\n\t\t\t\tbubbles: false\n\t\t\t}));\n\n\t\t// not using shadow DOM to avoid loading SLDS styles _everywhere_\n\t\tif (!this.locked) {\n\t\t\tconst selector = document.createElement('templating-block-selector');\n\t\t\tselector.assetId = this.assetId;\n\t\t\tthis.appendChild(selector);\n\t\t\tselector.addEventListener('change', dispatchEvent('template'));\n\t\t}\n\n\t\tthis.fieldSet = document.createElement('templating-block-fieldset');\n\t\tthis.appendChild(this.fieldSet);\n\n\t\tthis.fieldSet.addEventListener('change', dispatchEvent('fields'));\n\t}\n}\n\ncustomElements.define('templating-block-app', TemplatingBlockApp);\n","const placeholderRegex = /\\[\\[(\\w+)\\|([^|]+)\\|([^\\]]*)\\]\\]/g;\n\nexport function parseTemplate (template) {\n\tconst fields = [];\n\tlet match;\n\n\twhile (match = placeholderRegex.exec(template.content)) {\n\t\tfields.push({\n\t\t\ttype: match[1],\n\t\t\ttitle: match[2]\n\t\t});\n\t}\n\n\treturn fields;\n}\n\nexport function getHtml(template, fields = [], isFallback) {\n\tlet idx = 0;\n\treturn template.content.replace(placeholderRegex,\n\t\t(match, type, title, placeholder) => {\n\t\t\tlet replaceVal = '';\n\t\t\tif (fields[idx] && fields[idx].value) {\n\t\t\t\treplaceVal = fields[idx].value;\n\t\t\t} else if (isFallback) {\n\t\t\t\treplaceVal = placeholder;\n\t\t\t}\n\t\t\tidx++;\n\t\t\treturn replaceVal;\n\t\t}\n\t);\n}\n","import './components/templating-block-app';\nimport SDK from 'blocksdk';\nimport { getHtml, parseTemplate } from './lib/templating-block-utils';\nimport { getBlock } from './lib/api';\n\nconst sdk = new SDK();\n\nfunction initializeApp(data) {\n\tconst app = document.createElement('templating-block-app');\n\tapp.locked = data.locked;\n\tif (data.template) {\n\t\tapp.assetId = data.template.id;\n\t}\n\n\t// respond to app changes\n\tapp.addEventListener('change', e => {\n\t\t// always get current data\n\t\tsdk.getData(blockData => {\n\t\t\tconst newBlockData = blockData;\n\n\t\t\t// extend current data with new data\n\t\t\tswitch (e.detail.type) {\n\t\t\t\tcase 'template':\n\t\t\t\t\tnewBlockData.template = e.detail.template;\n\t\t\t\t\tnewBlockData.fields = parseTemplate(newBlockData.template);\n\t\t\t\t\tapp.fields = newBlockData.fields;\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'fields':\n\t\t\t\t\tnewBlockData.fields = e.detail.fields;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tsetEverything(newBlockData);\n\t\t});\n\t});\n\n\tdocument.getElementById('workspace').appendChild(app);\n\tapp.fields = data.fields;\n}\n\nfunction setEverything(data) {\n\t// always set data with latest\n\tsdk.setData(data);\n\t// set content with latest changes\n\tsdk.setContent(getHtml(data.template, data.fields, false));\n\t// update preview to use latest, with placeholders for preview\n\tsdk.setSuperContent(getHtml(data.template, data.fields, true));\n}\n\nasync function getOverrideData(data, assetId) {\n\tdata.template = await getBlock(assetId);\n\tdata.fields = parseTemplate(data.template).map((field, idx) => {\n\t\treturn {\n\t\t\t...field,\n\t\t\tvalue: data.fields && data.fields[idx] && data.fields[idx].value || ''\n\t\t};\n\t});\n\tdata.locked = true;\n\n\treturn data;\n}\n\nsdk.getData(async (data) => {\n\tif (window.app.assetId) {\n\t\tconst overrideData = await getOverrideData(data, window.app.assetId);\n\t\tsetEverything(overrideData);\n\t}\n\n\tinitializeApp(data);\n});\n\nsdk.triggerAuth(window.app.appID);\n"],"sourceRoot":""}